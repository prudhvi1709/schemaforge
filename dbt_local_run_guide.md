# Local dbt Run Guide using schemaforge-generated Rules

This guide assumes:

- You have a local dbt project set up (`my_dbt_project`).
- You have an Excel dataset (e.g., `dataset-pharma_synthetic.xlsx`).
- You have SQL/YAML content already generated by schemaforge in `dbt_rules.md`.
- You are using `duckdb` as the backend.

---

## 1. Project Structure

Ensure your directory looks like this:

```
my_dbt_project/
├── dbt_project.yml
├── models/
│   ├── patients_view.sql        # <-- Paste SQL model here
│   └── patients_view.yml        # <-- Paste tests YAML here
├── seeds/
│   └── patients.csv             # <-- Converted from Excel
├── dataset-pharma_synthetic.xlsx
└── my_local.duckdb              # Optional if using seed only
```

---

## 2. Convert Excel to CSV

Use any method (Python/pandas, Excel GUI) to convert `dataset-pharma_synthetic.xlsx` → `seeds/patients.csv`.

---

## 3. Paste dbt Rules

From `dbt_rules.md`, copy:

- The SQL model → `models/patients_view.sql`
- The associated YAML tests → `models/patients_view.yml`

Ensure SQL uses the seed name like:

```sql
SELECT * FROM {{ ref('patients') }}
```

---

## 4. Setup `dbt_project.yml`

Ensure this file has:

```yaml
name: "my_dbt_project"
version: "1.0"
profile: "my_dbt_project"

model-paths: ["models"]
seed-paths: ["seeds"]
target-path: "target"
clean-targets: ["target", "dbt_modules"]
```

---

## 5. Setup `profiles.yml`

Create this at `~/.dbt/profiles.yml`:

```yaml
my_dbt_project:
  target: dev
  outputs:
    dev:
      type: duckdb
      path: my_local.duckdb
```

If you're using **in-memory**, use:

```yaml
path: ":memory:"
```

> NOTE: If using `:memory:`, you must seed/load data every time.

---

##  6. Run dbt

```bash
cd my_dbt_project

# Load your dataset
dbt seed

# Run your model
dbt run

# Test for data quality issues
dbt test
```

---

## 7. Inspect Results

- Look at `target/run_results.json` for detailed test output.
- Use `dbt docs generate && dbt docs serve` (optional) to explore.

---

## What You Should See

- Seed loaded correctly.
- SQL model created as a view/table.
- Tests will FAIL if data quality issues exist — that’s the **intended outcome**.

---

## Notes

- dbt uses Jinja templating (`{{ ref(...) }}`) — make sure SQL uses it.
- Always re-run `dbt seed` if you modify the CSV.
- You can add more tests in the YAML file to expand validations.
